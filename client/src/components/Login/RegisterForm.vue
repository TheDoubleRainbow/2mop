<template>
    <div class = "login-form column card is-4">
        <div class="column is-12">
                <div>
                    <div class="typeQuestion">Who are you?</div>
                    <div class="buttons has-addons is-centered">
                        <span @click="data.type = 'user'" class="switchButton button" v-bind:class="data.type === 'user' ? 'is-link' : ''">Student</span>
                        <span @click="data.type = 'company'" class="switchButton button" v-bind:class="data.type === 'company' ? 'is-link' : ''">Company</span>
                    </div>
                </div>
        </div>
        <form @submit.prevent = "checkForm(data)">
            <div class="field">
                <label class="label">Email</label>
                <div class="control has-icons-left ">
                    <input v-model="data.email" class="input" type="email" placeholder="Email" />
                    <span class="icon is-small is-left">
                        <i class="fas fa-envelope"></i>
                    </span>
                </div>
            </div>
            <div class="field">
                <label class="label">First name</label>
                <div class="control has-icons-left ">
                    <input v-model="data.name.first" class="input" type="text" placeholder="First name" />
                    <span class="icon is-small is-left">
                        <i class="fas fa-envelope"></i>
                    </span>
                </div>
            </div>
            <div class="field">
                <label class="label">Last name</label>
                <div class="control has-icons-left ">
                    <input v-model="data.name.last" class="input" type="text" placeholder="Last name" />
                    <span class="icon is-small is-left">
                        <i class="fas fa-envelope"></i>
                    </span>
                </div>
            </div>
            <div class="field">
                <label class="label">Password</label>
                <div class="control has-icons-left">
                    <input v-model="data.password" class="input" type="password" placeholder="Password" />
                    <span class="icon is-small is-left">
                        <i class="fas fa-key"></i>
                    </span>
                </div>
            </div>
            <div class="field">
                <label class="label">Confirm password</label>
                <div class="control has-icons-left">
                    <input v-model="data.confirmPassword" class="input" type="password" placeholder="Confirm password" />
                    <span class="icon is-small is-left">
                        <i class="fas fa-key"></i>
                    </span>
                </div>
            </div>
            <div v-if="error.status" class="errorBlock">{{error.text}}</div>
            <div class="formError">{{errorText}}</div>
            <div class="loginButtonWrap">
                <button class="loginButton button is-dark">Register</button>
                <span class="or">OR</span>
                <router-link to='/login' class='button loginButton is-dark is-outlined'>
                    <span>Login</span>
                </router-link>
            </div>
        </form>
    </div>
</template>

<script>
export default {
    name: 'RegisterForm',
    props: {
      register: Function
    },
    data: function() {
        return {
            data: {
                type: 'user',
                email: '',
                password: '',
                confirmPassword: '',
                name: {
                    first: '',
                    last: ''
                }
            },
            error: {
                staus: 0,
                text: '',
            }
        }
    },
    methods: {
        checkForm: function(data){
            if(data.password === data.confirmPassword && data.password && data.confirmPassword){
                this.register(data)
                this.nullErorr()
            }else{
                this.error = {
                    text: 'Passwords do not match',
                    status: 1
                }
            }
        },
        nullErorr: function(){
            this.error = {
                status: 0,
                text: ''
            }
        }
    },
    computed: {
      errorText: function(){
          return this.$store.state.authError
      }
    }
}
</script>

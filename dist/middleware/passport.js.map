{"version":3,"sources":["../../middleware/passport.js"],"names":["opts","jwtFromRequest","ExtractJwt","fromAuthHeaderAsBearerToken","secretOrKey","config","jwtSecret","passport","use","Strategy","payload","done","type","Error","Model","userType","User","Company","findById","sub","then","user","catch","err"],"mappings":";;;;;;AAAA;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,IAAMA,OAAO;AACXC,kBAAgBC,wBAAWC,2BAAX,EADL;AAEXC,eAAaC,iBAAOC;AAFT,CAAb;;kBAKe;AAAA,SAAYC,SAASC,GAAT,CAAa,IAAIC,qBAAJ,CAAaT,IAAb,EAAmB,UAACU,OAAD,EAAUC,IAAV,EAAmB;AAC5E,QAAGD,QAAQE,IAAR,KAAiB,MAApB,EAA2B;AACzB,aAAOD,KAAK,IAAIE,KAAJ,CAAU,eAAV,CAAL,EAAiC,IAAjC,CAAP;AACD;;AAED,QAAIC,QAAQ,IAAZ;;AAEA,YAAOJ,QAAQK,QAAf;AACE,WAAK,MAAL;AACED,gBAASE,cAAT;AACA;AACF,WAAK,SAAL;AACEF,gBAAQG,iBAAR;AACA;AACF;AACA,eAAON,KAAK,IAAIE,KAAJ,CAAU,iBAAV,CAAL,EAAmC,IAAnC,CAAP;AARF;;AAWAC,UAAMI,QAAN,CAAeR,QAAQS,GAAvB,EACGC,IADH,CACQ,gBAAQ;AACZ,UAAIC,IAAJ,EAAU;AACR,eAAOV,KAAK,IAAL,EAAWU,IAAX,CAAP;AACD;;AAED,aAAOV,KAAK,IAAIE,KAAJ,CAAU,iBAAV,CAAL,EAAmC,IAAnC,CAAP;AACD,KAPH,EAQGS,KARH,CAQS;AAAA,aAAOX,KAAKY,GAAL,EAAU,KAAV,CAAP;AAAA,KART;AASD,GA3BuC,CAAb,CAAZ;AAAA,C","file":"passport.js","sourcesContent":["import { Strategy, ExtractJwt } from 'passport-jwt';\nimport User from '../models/user';\nimport Company from '../models/company';\nimport config from '../config';\n\nconst opts = {\n  jwtFromRequest: ExtractJwt.fromAuthHeaderAsBearerToken(),\n  secretOrKey: config.jwtSecret\n};\n\nexport default passport => passport.use(new Strategy(opts, (payload, done) => {\n  if(payload.type !== \"auth\"){\n    return done(new Error(\"Invalid token\"), null);\n  }\n\n  let Model = null;\n\n  switch(payload.userType){\n    case 'user': \n      Model =  User;\n      break;\n    case 'company':\n      Model = Company;\n      break;\n    default: \n    return done(new Error(\"User not found.\"), null);\n  }\n\n  Model.findById(payload.sub)\n    .then(user => {\n      if (user) {\n        return done(null, user);\n      }\n\n      return done(new Error(\"User not found.\"), null);\n    })\n    .catch(err => done(err, false))\n}));"]}
{"version":3,"sources":["../../api/logout.js"],"names":["logoutApi","create","res","body","headers","refreshToken","jwt","verify","config","jwtSecret","err","decoded","type","UserModel","findById","sub","then","user","refresh_tokens","filter","e","auth_tokens","save","json","status","message","catch","devMessage","resMessage","error","succsess","toString"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,IAAMA,YAAY,wCAAS;AACnBC,UADmB,wBACQC,GADR,EACa;AAAA,YAAtBC,IAAsB,QAAtBA,IAAsB;AAAA,YAAhBC,OAAgB,QAAhBA,OAAgB;;AAChC,YAAMC,eAAeF,KAAKE,YAAL,IAAqB,EAA1C;AACAC,+BAAIC,MAAJ,CAAWF,YAAX,EAAyBG,iBAAOC,SAAhC,EAA2C,UAACC,GAAD,EAAMC,OAAN,EAAkB;AACzD,gBAAG,CAACD,GAAD,IAAQC,QAAQC,IAAR,IAAgB,SAA3B,EAAqC;AACjCC,+BAAUC,QAAV,CAAmBH,QAAQI,GAA3B,EAAgCC,IAAhC,CAAqC,gBAAQ;AACzC,wBAAIC,IAAJ,EAAU;AACNA,6BAAKC,cAAL,GAAsBD,KAAKC,cAAL,CAAoBC,MAApB,CAA2B;AAAA,mCAAKC,MAAMf,YAAX;AAAA,yBAA3B,CAAtB;;AAEA,4BAAID,WAAWA,QAAQ,eAAR,CAAf,EAAwC;AACpCa,iCAAKI,WAAL,GAAmBJ,KAAKI,WAAL,CAAiBF,MAAjB,CAAwB;AAAA,uCAAKC,MAAMhB,QAAQ,eAAR,CAAX;AAAA,6BAAxB,CAAnB;AACH;AACDa,6BAAKK,IAAL,GACCN,IADD,CAEId,IAAIqB,IAAJ,CAAS;AACTC,oCAAQ,CADC;AAETC,qCAAS;AAFA,yBAAT,CAFJ,EAMCC,KAND,CAMO;AAAA,mCAASxB,IAAIqB,IAAJ,CAAS;AACrBC,wCAAQ,CAAC,CADY;AAErBC,yCAAS,iBAFY;AAGrBE,4CAAYC,WAAWC,MAAMJ,OAAjB;AAHS,6BAAT,CAAT;AAAA,yBANP;AAWH;AACJ,iBAnBD;AAoBH,aArBD,MAqBO;AACHvB,oBAAIsB,MAAJ,CAAW,GAAX,EAAgBD,IAAhB,CAAqB;AACjBO,8BAAU,KADO;AAEjBL,6BAASf,IAAIqB,QAAJ;AAFQ,iBAArB;AAIH;AACJ,SA5BD;AA6BH;AAhCsB,CAAT,CAAlB;;kBAmCe/B,S","file":"logout.js","sourcesContent":["import resource from 'resource-router-middleware';\nimport jwt from 'jsonwebtoken';\nimport UserModel from '../models/user';\nimport config from '../config';\n\nconst logoutApi = resource({\n        create ({ body, headers }, res) {\n        const refreshToken = body.refreshToken || \"\";\n        jwt.verify(refreshToken, config.jwtSecret, (err, decoded) => {\n            if(!err && decoded.type == \"refresh\"){\n                UserModel.findById(decoded.sub).then(user => {\n                    if (user) {\n                        user.refresh_tokens = user.refresh_tokens.filter(e => e !== refreshToken);\n\n                        if( headers && headers['authorization']){\n                            user.auth_tokens = user.auth_tokens.filter(e => e !== headers['authorization']);\n                        }\n                        user.save()\n                        .then(\n                            res.json({\n                            status: 0,\n                            message: 'Logout successful',\n                        }))\n                        .catch(error => res.json({\n                            status: -1,\n                            message: 'Logout failture',\n                            devMessage: resMessage(error.message)\n                        }))\n                    }\n                });\n            } else {\n                res.status(400).json({\n                    succsess: false,\n                    message: err.toString(),\n                })\n            }\n        })\n    }\n});\n\nexport default logoutApi;"]}
{"version":3,"sources":["../../api/course.js"],"names":["router","express","Router","get","res","query","page","parseInt","perPage","owner","CourseModel","paginate","offset","limit","then","json","status","message","devMessage","data","result","docs","metaData","totalPages","total","currentPage","catch","error","courseId","params","findById","post","requireAuth","body","user","type","course","name","photo","description","ownerId","_id","location","placeId","formattedAddress","date","save","code","ApplyModel","findOne","applyerId","eventId","a","apply","eventType","put","findOneAndUpdate","new","doc","delete","findOneAndRemove","err"],"mappings":"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","file":"course.js","sourcesContent":["import CourseModel from '../models/course';\nimport ApplyModel from '../models/apply';\nimport requireAuth from '../middleware/require-auth';\nimport express from 'express';\n//import courseModel from '../models/course';\nconst router = express.Router();\n\nrouter.get('/', ({query}, res) => {\n\t//CourseModel.find({}, {auth_tokens: 0, refresh_tokens: 0}).\n\tconst page = parseInt(query.page || 0);\n    const perPage = parseInt(query.perPage || 20);\n    const owner = query.owner; \n\tCourseModel.paginate(owner ? {owner} : {}, {offset: page * perPage , limit: perPage})\n        \n        .then(result => res.json({\n\t\t\tstatus: 0,\n\t\t\tmessage: \"\",\n\t\t\tdevMessage: \"\",\n\t\t\tdata: result.docs,\n\t\t\tmetaData: {\n\t\t\t\ttotalPages: result.total % perPage == 0 ? result.total / perPage : parseInt(result.total / perPage) + 1,\n\t\t\t\tperPage: perPage,\n\t\t\t\tcurrentPage: page\t\t\n\t\t\t}\n\t\t}))\n\t\t.catch(error => res.json({\n\t\t\tstatus: -1,\n\t\t\tmessage: \"\",\n\t\t\tdevMessage: error,\n\t\t}))\n});\n\nrouter.get('/:courseId', ({ params: { courseId } }, res) => {\n\tCourseModel.findById(courseId)\n\t\t.then(result => res.json({\n\t\t\tstatus: 0,\n\t\t\tmessage: \"\",\n\t\t\tdevMessage: \"\",\n\t\t\tdata: result,\n\t\t}))\n\t\t.catch(error => res.json({\n\t\t\tstatus: -1,\n\t\t\tmessage: \"\",\n\t\t\tdevMessage: \"Course not found\",\n\t\t}))\n});\n\nrouter.post('/', requireAuth, ({body, user}, res) => {\n\tif(user.type == \"company\"){\n\t\tconst course = new CourseModel({name: body.name, photo: body.photo, description: body.description, ownerId: user._id, location: {placeId: body.placeId, formattedAddress: body.formattedAddress || 'City name'}, date: body.date});\n\t\tcourse.save()\t\t\t\n\t\t\t.then( () => {\n\t\t\t\tres.json({\n\t\t\t\t\tstatus: 0,\n\t\t\t\t\tmessage: 'Course successfull created',\n\t\t\t\t\tdata: course,\n\t\t\t\t})\n\t\t\t})\n\t\t\t.catch(error => {\n\t\t\t\tres.json({\n\t\t\t\t\tstatus: error.code || -1,\n\t\t\t\t\tmessage: \"\",\n\t\t\t\t\t//devMessage: resMessage(error.message)\n\t\t\t\t\tdevMessage: error.message,\n\t\t\t\t})\n\t\t\t})\n\t} else {\n\t\tres.json({\n\t\t\tstatus: 7,\n\t\t\tmessage: \"\",\n\t\t\tdevMessage: \"You don't have permissions to do it\",\n\t\t})\n\t}\n});\n\nrouter.post('/:courseId/apply', requireAuth, ({ params: { courseId }, user }, res) => {\n\tif(user.type == \"user\"){\n\t\tApplyModel.findOne({applyerId: user._id, eventId: courseId}).then( a => {\n\t\t\tif(a != null){\n\t\t\t\tres.json({\n\t\t\t\t\tstatus: -1,\n\t\t\t\t\tmessage: 'You are applyed already',\n\t\t\t\t})\n\t\t\t} else {\n\t\t\t\tconst apply = new ApplyModel({applyerId: user._id, eventType: \"course\", eventId: courseId});\n\t\t\t\tapply.save()\t\t\t\n\t\t\t\t.then( () => {\n\t\t\t\t\tres.json({\n\t\t\t\t\t\tstatus: 0,\n\t\t\t\t\t\tmessage: 'Apply successfull created',\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t\t.catch(error => {\n\t\t\t\t\tres.json({\n\t\t\t\t\t\tstatus: error.code || -1,\n\t\t\t\t\t\tmessage: \"\",\n\t\t\t\t\t\t//devMessage: resMessage(error.message)\n\t\t\t\t\t\tdevMessage: error.message,\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t}\n\t\t});\n\t} else {\n\t\tres.json({\n\t\t\tstatus: 7,\n\t\t\tmessage: \"\",\n\t\t\tdevMessage: \"You don't have permissions to do it\",\n\t\t})\n\t}\n});\n\nrouter.put('/:courseId', requireAuth, ({ params: { courseId }, body, user }, res) => {\n\t// let updates = {name: body.name, avatar: body.avatar, birthDate: body.birthDate, description: body.description, skills: body.skills, phoneNumper: body.phoneNumper};\n\t// let update = {name: body.name};\n\tCourseModel.findOneAndUpdate({_id: courseId, ownerId: user._id}, {name: body.name, photo: body.photo, description: body.description, ownerId: user._id, location: {placeId: body.placeId, formattedAddress: body.formattedAddress || 'City name'}, date: body.date}, {new: true}).then( doc => {\n\t\tres.json({\n\t\t\tstatus: 0,\n\t\t\tmessage: \"\",\n\t\t\tdevMessage: \"Vacation successfull update\",\n\t\t\tdata: doc\n\t\t})\n\t}).catch( error => {\n\t\tres.json({\n\t\t\tstatus: -1,\n\t\t\tmessage: \"\",\n\t\t\tdevMessage: error,\n\t\t})\n\t});\n})\n\nrouter.delete('/:courseId', requireAuth, ({ params: { courseId }, user }, res) => {\n//\tif(courseId == course._id){\n\t\t//CourseModel.findByIdAndRemove(courseId)\n\t\tCourseModel.findOneAndRemove({_id: courseId, ownerId: user._id})\n        .then((result) => {\n            if(result == null){\n                res.json({\n                    status: 0,\n                    message: \"\",\n                    devMessage: \"Invalid course id or you do not have permissions\",\n                })\n            } else {\n                res.json({\n                    status: 0,\n                    message: \"\",\n                    devMessage: \"Course successfuly deleted\",\n                })\n            }\n        })\n\t\t\t.catch((err) => res.json({\n\t\t\t\tstatus: -1,\n\t\t\t\tmessage: \"\",\n\t\t\t\tdevMessage: err,\n\t\t\t}));\n\t// } else {\n\t// \tres.json({\n\t// \t\tstatus: -1,\n\t// \t\tmessage: \"\",\n\t// \t\tdevMessage: \"You don't have permissions to do it\",\n\t// \t})\n\t// }\n})\n\nexport default router;\n\n"]}
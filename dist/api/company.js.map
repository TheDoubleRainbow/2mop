{"version":3,"sources":["../../api/company.js"],"names":["router","express","Router","get","requireAuth","res","query","page","parseInt","perPage","CompanyModel","paginate","offset","limit","then","send","status","message","devMessage","data","result","docs","metaData","totalPages","total","currentPage","catch","json","error","toString","req","companyId","params","findById","put","body","company","_id","findByIdAndUpdate","name","avatar","webSite","description","phoneNumper","location","err","delete","findByIdAndRemove"],"mappings":"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","file":"company.js","sourcesContent":["import resource from 'resource-router-middleware';\nimport { merge, get, isEmpty } from 'lodash/fp';\nimport resMessage from '../lib/res-message';\nimport CompanyModel from '../models/company';\nimport requireAuth from '../middleware/require-auth';\nimport express from 'express';\nconst router = express.Router();\n\nrouter.get('/', requireAuth, ({query}, res) => {\n\t//CompanyModel.find({}, {auth_tokens: 0, refresh_tokens: 0}).\n\tconst page = parseInt(query.page || 0);\n\tconst perPage = parseInt(query.perPage || 20);\n\tCompanyModel.paginate({}, {offset: page * perPage , limit: perPage})\n\t\t.then(result => res.send({\n\t\t\tstatus: 0,\n\t\t\tmessage: \"\",\n\t\t\tdevMessage: \"\",\n\t\t\tdata: result.docs,\n\t\t\tmetaData: {\n\t\t\t\ttotalPages: result.total % perPage == 0 ? result.total / perPage : parseInt(result.total / perPage) + 1,\n\t\t\t\tperPage: perPage,\n\t\t\t\tcurrentPage: page\t\t\n\t\t\t}\n\t\t}))\n\t\t.catch(error => res.json({\n\t\t\tstatus: -1,\n\t\t\tmessage: \"\",\n\t\t\tdevMessage: error.toString(),\n\t\t}))\n});\n\nrouter.get('/:companyId', ({ params: { companyId } }, req) => {\n\tCompanyModel.findById(companyId)\n\t\t.then(result => res.send({\n\t\t\tstatus: 0,\n\t\t\tmessage: \"\",\n\t\t\tdevMessage: \"\",\n\t\t\tdata: result,\n\t\t}))\n\t\t.catch(error => res.json({\n\t\t\tstatus: -1,\n\t\t\tmessage: \"\",\n\t\t\tdevMessage: \"Company not found\",\n\t\t}))\n});\n\nrouter.put('/:companyId', requireAuth, ({ params: { companyId }, body, company }, res) => {\n\tif(companyId == company._id){\n\t\tCompanyModel.findByIdAndUpdate(companyId, {name: body.name, avatar: body.avatar, webSite: body.webSite, description: body.description, phoneNumper: body.phoneNumper, location: body.location})\n\t\t\t.then(() => res.json({\n\t\t\t\tstatus: 0,\n\t\t\t\tmessage: \"\",\n\t\t\t\tdevMessage: \"Company data update success\",\n\t\t\t}))\n\t\t\t.catch((err) => res.json({\n\t\t\t\tstatus: -1,\n\t\t\t\tmessage: \"\",\n\t\t\t\tdevMessage: err.toString,\n\t\t\t}));\n\t} else {\n\t\tres.json({\n\t\t\tstatus: -1,\n\t\t\tmessage: \"\",\n\t\t\tdevMessage: \"You don't have permissions\",\n\t\t})\n\t}\n})\n\nrouter.delete('/:companyId', requireAuth, ({ params: { companyId }, body, company }, res) => {\n\tif(companyId == company._id){\n\t\tCompanyModel.findByIdAndRemove(companyId)\n\t\t\t.then(() => res.json({\n\t\t\t\tstatus: 0,\n\t\t\t\tmessage: \"\",\n\t\t\t\tdevMessage: \"Company successfuly deleted\",\n\t\t\t}))\n\t\t\t.catch((err) => res.json({\n\t\t\t\tstatus: -1,\n\t\t\t\tmessage: \"\",\n\t\t\t\tdevMessage: err.toString,\n\t\t\t}));\n\t} else {\n\t\tres.json({\n\t\t\tstatus: -1,\n\t\t\tmessage: \"\",\n\t\t\tdevMessage: \"You don't have permissions to do it\",\n\t\t})\n\t}\n})\nexport default router;\n"]}